["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Uint8Array(32);i.fill(255);var j=new Uint8Array([1]),k=new Uint8Array([2]);function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e,f=a.regId;a=a.staticKeyPair;var g=b.identity,h=b.signedKey.publicKey,j=c.privateKey,k=a.privateKey;e=(e=b.oneTimeKey)==null?void 0:e.publicKey;k=d("WABinary").Binary.build(i,v(k,h),v(j,g),v(j,h),e&&v(j,e)).readByteArrayView();h=(yield t(k,"WhisperText"));j=h[0];e=h[1];k=b.ratchetKey;h=d("WASignalSessions").makeFreshRecvChain(k,e);e=d("WASignalKeys").makeSerializedKeyPair();j=(yield r(j,e,k));k=d("WASignalSessions").makeInitialExchangeInfo(b.oneTimeKey==null?null:b.oneTimeKey.id,b.signedKey.id,d("WASignalKeys").serializePubKey(c));return d("WASignalSessions").makeFreshSession({regId:f,pubKey:d("WASignalKeys").serializePubKey(a)},{regId:b.regId,pubKey:g},j.rootKey,[h],d("WASignalSessions").makeFreshSendChain(e,j.chainKey),k,d("WASignalKeys").serializePubKey(c))});return l.apply(this,arguments)}function c(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=a.regId;a=a.staticKeyPair;var h=a.privateKey,j=e.signed.privateKey,k=c,l=b.pubKey;f=(f=e.oneTime)==null?void 0:f.privateKey;l=d("WABinary").Binary.build(i,w(l,j),w(k,h),w(k,j),f&&w(k,f)).readByteArrayView();h=(yield t(l,"WhisperText"));j=h[0];k=h[1];f=e.ratchet;l=d("WASignalSessions").makeFreshSendChain(f,k);return d("WASignalSessions").makeSession({regId:g,pubKey:d("WASignalKeys").serializePubKey(a)},b,j,[],l,null,0,[],c)});return m.apply(this,arguments)}function e(a){a=d("WASignalGroupSession").makeSenderKeyState(d("WASignalKeys").serializePubKey(a),a.privateKey,d("WASignalGroupSession").makeSenderKeyChainKey(0,d("WASignalKeys").makeRawSenderKey()),d("WASignalOther").makeSenderKeyId(),[]);return(h||(h=b("Promise"))).resolve(d("WASignalGroupSession").makeNewSenderKeySession(a))}function f(a,c,e,f,g){e=d("WASignalGroupSession").makeSenderKeyState(e,void 0,d("WASignalGroupSession").makeSenderKeyChainKey(c,f),a,[]);c=null;g?c=d("WASignalGroupSession").updateSessionWithNewSenderKeyState(g,e):c=d("WASignalGroupSession").makeNewSenderKeySession(e);return(h||(h=b("Promise"))).resolve(c)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));c=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};var f=c(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperMessageKeys",80)}).then(function(b){return d("WASignalSessions").splitMsgKey(a,b)});c=c(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return(h||(h=b("Promise"))).all([c,f])});return o.apply(this,arguments)}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));c=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};var f=c(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperGroup",50)}).then(function(b){return d("WASignalGroupSession").makeSenderKeyMsgKey(a,b)});c=c(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return(h||(h=b("Promise"))).all([c,f])});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=b.privateKey;c=c;b=d("WASignalKeys").ecdh(b,c);c=(yield t(new Uint8Array(b),"WhisperRatchet",a));b=c[0];a=c[1];return{rootKey:b,chainKey:a}});return s.apply(this,arguments)}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=null);a=(yield d("WASignalOther").hkdf(a,c,b,64));return[d("WASignalOther").sliceBytes(a,0,32),d("WASignalOther").sliceBytes(a,32,32)]});return u.apply(this,arguments)}function v(a,b){return new Uint8Array(d("WASignalKeys").ecdh(a,b))}function w(a,b){return v(b,a)}g.initiateSessionOutgoing=a;g.initiateSessionIncoming=c;g.initiateSenderKeySessionOutgoing=e;g.initiateSenderKeySessionIncoming=f;g.deriveMsgKey=n;g.deriveSenderKeyMsgKey=p;g.calculateRatchet=r}),98);
