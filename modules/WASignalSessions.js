["WABinary","WACryptoLibraryConfig","WASignalKeys","WASignalOther","err"],(function(a,b,c,d,e,f,g){"use strict";var h=3;function a(a){if(!d("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658AutoAcknowledgeStaleSessions)return a;return a.initialExchangeInfo==null?a:o(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,null,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function b(a,b){return i(a,0,b,[])}function i(a,b,c,d){return{ratchetPubKey:a,nextMsgIndex:b,chainKey:c,unusedMsgKeys:d}}function e(a,b){return j(a,0,b)}function j(a,b,c){return{ratchetKey:a,nextMsgIndex:b,chainKey:c}}function k(a,b,c){return{remoteOneTimeId:a,remoteSignedId:b,localOneTimePubKey:c}}function f(a,b){return o(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,a.initialExchangeInfo,a.prevSendChainHighestIndex,b,a.aliceBaseKey)}function l(a,b,c){return o(a.local,a.remote,a.rootKey,b,c,a.initialExchangeInfo,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function m(a,b,c,d){c===void 0&&(c=a.sendChain);return o(a.local,a.remote,d,b,c,null,Math.max(a.sendChain.nextMsgIndex-1,0),a.prevSessions,a.aliceBaseKey)}function n(a,b,c,d,e,f,g){return o(a,b,c,d,e,f,0,[],g)}function o(a,b,c,d,e,f,g,h,i){return{local:a,remote:b,rootKey:c,sendChain:e,recvChains:d,initialExchangeInfo:f,prevSendChainHighestIndex:g,prevSessions:h,aliceBaseKey:i}}function p(a,b){b=new(d("WABinary").Binary)(b);var c=d("WASignalOther").readBytes(b,32),e=d("WASignalOther").readBytes(b,32);b=d("WASignalOther").readBytes(b,16);return q(a,c,e,b)}function q(a,b,c,d){return{index:a,cipherKey:b,macKey:c,iv:d}}function r(a){return{senderRatchetKey:a.ratchetPubKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey},messageKeys:a.unusedMsgKeys}}function s(a){var b=a.ratchetKey;return{senderRatchetKey:b.serializedPubKey,senderRatchetKeyPrivate:b.privateKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey}}}function t(a){var b=a.local,c=a.remote,d=a.initialExchangeInfo,e=void 0;if(d){var f=d.remoteOneTimeId;e={preKeyId:f!=null?f:void 0,signedPreKeyId:d.remoteSignedId,baseKey:d.localOneTimePubKey}}return{currentSession:{sessionVersion:h,localIdentityPublic:b.pubKey,remoteIdentityPublic:c.pubKey,rootKey:a.rootKey,previousCounter:a.prevSendChainHighestIndex,senderChain:s(a.sendChain),receiverChains:a.recvChains.map(r),pendingPreKey:e,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey},previousSessions:a.prevSessions}}function u(a){var b=a.local,c=a.remote,e=a.sendChain,f=a.initialExchangeInfo,g=void 0;if(f){var i=f.remoteOneTimeId;g={preKeyId:i!=null?i:void 0,signedPreKeyId:f.remoteSignedId,baseKey:d("WASignalOther").toBuffer(f.localOneTimePubKey)}}return{sessionVersion:h,localIdentityPublic:d("WASignalOther").toBuffer(b.pubKey),remoteIdentityPublic:d("WASignalOther").toBuffer(c.pubKey),rootKey:d("WASignalOther").toBuffer(a.rootKey),previousCounter:a.prevSendChainHighestIndex,senderChain:{senderRatchetKey:d("WASignalOther").toBuffer(e.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:d("WASignalOther").toBuffer(e.ratchetKey.privateKey),chainKey:{index:e.nextMsgIndex,key:d("WASignalOther").toBuffer(e.chainKey)},messageKeys:[]},receiverChains:a.recvChains.map(function(a){return{senderRatchetKey:d("WASignalOther").toBuffer(a.ratchetPubKey),chainKey:{index:a.nextMsgIndex,key:d("WASignalOther").toBuffer(a.chainKey)},messageKeys:a.unusedMsgKeys.map(function(a){return{index:a.index,cipherKey:d("WASignalOther").toBuffer(a.cipherKey),macKey:d("WASignalOther").toBuffer(a.macKey),iv:d("WASignalOther").toBuffer(a.iv)}})}}),pendingPreKey:g,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey==null?void 0:d("WASignalOther").toBuffer(a.aliceBaseKey)}}function v(a){var b=B(a.currentSession,"currentSession");return x(b,a.previousSessions)}function w(a){return x(a,[])}function x(a,b){var e=B(a.sessionVersion,"sessionVersion");if(e!==h)throw c("err")("Signal: bad session version "+e);e=B(a.senderChain,"senderChain");var f=B(e.chainKey,"senderChain.chainKey");e=j(d("WASignalKeys").makeSerializedKeyPairFrom(A(e.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),z(e.senderRatchetKey,"senderRatchetKey")),B(f.index,"senderChain.chainKey.index"),A(f.key,32,"senderChain.chainKey.key"));f=B(a.receiverChains,"receiverChains").map(function(a){var b=B(a.chainKey,"receiverChains[].chainKey");return i(z(a.senderRatchetKey,"receiverChains[].senderRatchetKey"),B(b.index,"receiverChains[].chainKey.index"),A(b.key,32,"receiverChains[].chainKey.key"),y(a.messageKeys))});var g={regId:d("WASignalOther").castRegistrationId(B(a.localRegistrationId,"localRegistrationId")),pubKey:z(a.localIdentityPublic,"localIdentityPublic")},l={regId:d("WASignalOther").castRegistrationId(B(a.remoteRegistrationId,"remoteRegistrationId")),pubKey:z(a.remoteIdentityPublic,"remoteIdentityPublic")},m=a.pendingPreKey,n=null;if(m){var p=m.preKeyId;n=k(p!=null?d("WASignalKeys").castToPreKeyId(p):null,d("WASignalKeys").castToSignedPreKeyId(B(m.signedPreKeyId,"pendingPreKey.signedPreKeyId")),z(m.baseKey,"pendingPreKey.baseKey"))}p=a.aliceBaseKey==null?null:z(a.aliceBaseKey,"aliceBaseKey");return o(g,l,A(a.rootKey,32,"rootKey"),f,e,n,a.previousCounter||0,b,p)}function y(a){return a.map(function(a){return{index:B(a.index,"messageKeys[].index"),cipherKey:A(a.cipherKey,32,"messageKeys[].cipherKey"),macKey:A(a.macKey,32,"messageKeys[].macKey"),iv:A(a.iv,16,"messageKeys[].iv")}})}function z(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(B(a,b)))}function A(a,b,c){return d("WASignalOther").toBytes(B(a,c),b)}function B(a,b){if(a==null)throw c("err")("Signal: protobuf is missing "+b);return a}g.FORMAT_VERSION=h;g.maybeClearPendingPreKey=a;g.makeFreshRecvChain=b;g.makeRecvChain=i;g.makeFreshSendChain=e;g.makeSendChain=j;g.makeInitialExchangeInfo=k;g.setPrevSessions=f;g.updateChains=l;g.ratchetSession=m;g.makeFreshSession=n;g.makeSession=o;g.splitMsgKey=p;g.serializeSession=t;g.detachSession=u;g.parseSessionFromRecord=v;g.parseSession=w;g._parseSession=x;g.bytesOrThrow=A;g.definedOrThrow=B}),98);
